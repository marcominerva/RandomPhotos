const defaultOptions={captionContent:".pswp-caption-content",type:"auto",horizontalEdgeThreshold:20,mobileCaptionOverlapRatio:.3,mobileLayoutBreakpoint:600,verticallyCenterImage:!1};class PhotoSwipeDynamicCaption{constructor(e,i){this.options={...defaultOptions,...i},this.lightbox=e,this.lightbox.on("init",()=>{this.pswp=this.lightbox.pswp,this.initCaption()})}initCaption(){const n=this["pswp"];n.on("change",()=>{this.showCaption(this.pswp.currSlide)}),n.on("calcSlideSize",e=>this.onCalcSlideSize(e)),n.on("slideDestroy",e=>{e.slide.dynamicCaption&&(e.slide.dynamicCaption.element&&e.slide.dynamicCaption.element.remove(),delete e.slide.dynamicCaption)}),n.on("zoomPanUpdate",({slide:i})=>{if(n.opener.isOpen&&i.dynamicCaption){if(i.currZoomLevel>i.zoomLevels.initial?this.hideCaption(i):this.showCaption(i),i.dynamicCaption.element){let e=0;var t;i.currZoomLevel<=i.zoomLevels.initial&&(t=i.pan.y-i.bounds.center.y,1<Math.abs(t)&&(e=t)),this.setCaptionYOffset(i.dynamicCaption.element,e)}this.adjustPanArea(i,i.currZoomLevel)}}),n.on("beforeZoomTo",e=>{this.adjustPanArea(n.currSlide,e.destZoomLevel)}),n.on("tapAction",e=>{e.originalEvent.target.closest(".pswp__dynamic-caption")&&e.preventDefault()})}adjustPanArea(e,i){e.dynamicCaption&&e.dynamicCaption.adjustedPanAreaSize&&(i>e.zoomLevels.initial?(e.panAreaSize.x=e.dynamicCaption.originalPanAreaSize.x,e.panAreaSize.y=e.dynamicCaption.originalPanAreaSize.y):(e.panAreaSize.x=e.dynamicCaption.adjustedPanAreaSize.x,e.panAreaSize.y=e.dynamicCaption.adjustedPanAreaSize.y))}useMobileLayout(){const e=this.options["mobileLayoutBreakpoint"];return"function"==typeof e?e.call(this):"number"==typeof e&&window.innerWidth<e}hideCaption(e){if(e.dynamicCaption&&!e.dynamicCaption.hidden){const i=e.dynamicCaption.element;i&&(e.dynamicCaption.hidden=!0,i.classList.add("pswp__dynamic-caption--faded"),e.captionFadeTimeout&&clearTimeout(e.captionFadeTimeout),e.captionFadeTimeout=setTimeout(()=>{i.style.visibility="hidden",delete e.captionFadeTimeout},400))}}setCaptionYOffset(e,i){e.style.transform=`translateY(${i}px)`}showCaption(e){if(e.dynamicCaption&&e.dynamicCaption.hidden){const i=e.dynamicCaption.element;i&&(e.dynamicCaption.hidden=!1,i.style.visibility="visible",clearTimeout(e.captionFadeTimeout),e.captionFadeTimeout=setTimeout(()=>{i.classList.remove("pswp__dynamic-caption--faded"),delete e.captionFadeTimeout},50))}}setCaptionPosition(e,i,t){var n=i<=this.options.horizontalEdgeThreshold;e.classList[n?"add":"remove"]("pswp__dynamic-caption--on-hor-edge"),e.style.left=i+"px",e.style.top=t+"px"}setCaptionWidth(e,i){i?e.style.width=i+"px":e.style.removeProperty("width")}setCaptionType(e,i){var t=e.dataset.pswpCaptionType;i!==t&&(e.classList.add("pswp__dynamic-caption--"+i),e.classList.remove("pswp__dynamic-caption--"+t),e.dataset.pswpCaptionType=i)}updateCaptionPosition(e){if(e.dynamicCaption&&e.dynamicCaption.type&&e.dynamicCaption.element){if("mobile"===e.dynamicCaption.type)return this.setCaptionType(e.dynamicCaption.element,e.dynamicCaption.type),e.dynamicCaption.element.style.removeProperty("left"),e.dynamicCaption.element.style.removeProperty("top"),void this.setCaptionWidth(e.dynamicCaption.element,!1);var i=e.zoomLevels.initial,t=Math.ceil(e.width*i),i=Math.ceil(e.height*i);this.setCaptionType(e.dynamicCaption.element,e.dynamicCaption.type),"aside"===e.dynamicCaption.type?(this.setCaptionPosition(e.dynamicCaption.element,e.bounds.center.x+t,e.bounds.center.y),this.setCaptionWidth(e.dynamicCaption.element,!1)):"below"===e.dynamicCaption.type&&(this.setCaptionPosition(e.dynamicCaption.element,e.bounds.center.x,e.bounds.center.y+i),this.setCaptionWidth(e.dynamicCaption.element,t))}}onCalcSlideSize(e){const i=e["slide"];let t,n;if(!i.dynamicCaption){i.dynamicCaption={element:void 0,type:!1,hidden:!1};var a=this.getCaptionHTML(i);if(!a)return;i.dynamicCaption.element=document.createElement("div"),i.dynamicCaption.element.className="pswp__dynamic-caption pswp__hide-on-close",i.dynamicCaption.element.innerHTML=a,this.pswp.dispatch("dynamicCaptionUpdateHTML",{captionElement:i.dynamicCaption.element,slide:i}),i.holderElement.appendChild(i.dynamicCaption.element)}var o,p,s;i.dynamicCaption.element&&(this.storeOriginalPanAreaSize(i),i.bounds.update(i.zoomLevels.initial),this.useMobileLayout()?(i.dynamicCaption.type="mobile",n=!0):"auto"===this.options.type?i.bounds.center.x>i.bounds.center.y?i.dynamicCaption.type="aside":i.dynamicCaption.type="below":i.dynamicCaption.type=this.options.type,a=Math.ceil(i.width*i.zoomLevels.initial),s=Math.ceil(i.height*i.zoomLevels.initial),this.setCaptionType(i.dynamicCaption.element,i.dynamicCaption.type),"aside"===i.dynamicCaption.type?(this.setCaptionWidth(i.dynamicCaption.element,!1),p=(t=this.measureCaptionSize(i.dynamicCaption.element,e.slide)).x,o=a+i.bounds.center.x,i.panAreaSize.x-o<=p&&(i.panAreaSize.x-=p,this.recalculateZoomLevelAndBounds(i))):"below"!==i.dynamicCaption.type&&!n||(this.setCaptionWidth(i.dynamicCaption.element,n?this.pswp.viewportSize.x:a),o=(t=this.measureCaptionSize(i.dynamicCaption.element,e.slide)).y,this.options.verticallyCenterImage?(i.panAreaSize.y-=o,this.recalculateZoomLevelAndBounds(i)):(p=s+i.bounds.center.y,a=i.panAreaSize.y-p,e=i.panAreaSize.y,a<=o&&(i.panAreaSize.y-=Math.min(2*(o-a),o),this.recalculateZoomLevelAndBounds(i),s=i.panAreaSize.x*this.options.mobileCaptionOverlapRatio/2,n&&i.bounds.center.x>s&&(i.panAreaSize.y=e,this.recalculateZoomLevelAndBounds(i))))),this.storeAdjustedPanAreaSize(i),this.updateCaptionPosition(i))}measureCaptionSize(e,i){var t=e.getBoundingClientRect();return this.pswp.dispatch("dynamicCaptionMeasureSize",{captionEl:e,slide:i,captionSize:{x:t.width,y:t.height}}).captionSize}recalculateZoomLevelAndBounds(e){e.zoomLevels.update(e.width,e.height,e.panAreaSize),e.bounds.update(e.zoomLevels.initial)}storeAdjustedPanAreaSize(e){e.dynamicCaption&&(e.dynamicCaption.adjustedPanAreaSize||(e.dynamicCaption.adjustedPanAreaSize={}),e.dynamicCaption.adjustedPanAreaSize.x=e.panAreaSize.x,e.dynamicCaption.adjustedPanAreaSize.y=e.panAreaSize.y)}storeOriginalPanAreaSize(e){e.dynamicCaption&&(e.dynamicCaption.originalPanAreaSize||(e.dynamicCaption.originalPanAreaSize={}),e.dynamicCaption.originalPanAreaSize.x=e.panAreaSize.x,e.dynamicCaption.originalPanAreaSize.y=e.panAreaSize.y)}getCaptionHTML(e){if("function"==typeof this.options.captionContent)return this.options.captionContent.call(this,e);const i=e.data.element;let t="";if(i){e=i.querySelector(this.options.captionContent);if(e)t=e.innerHTML;else{const n=i.querySelector("img");n&&(t=n.getAttribute("alt"))}}return t}}export default PhotoSwipeDynamicCaption;